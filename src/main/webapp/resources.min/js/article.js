"use strict";const userId=document.getElementById("user_id").getAttribute("content"),ownerId=document.getElementById("owner_id").getAttribute("content"),href=location.href,articleId=href.substring(href.lastIndexOf("/")+1,href.length);let voted=!1;function initRating(){const e=document.querySelector(".article-footer .article-rating"),t=e.firstElementChild,n=e.lastElementChild,i=e.querySelector("span");function c(e){voted||(ownerId!==userId?xhr.request({path:"/services/articles/rating",method:"POST",headers:{"Content-Type":"application/json"},content:JSON.stringify({id:articleId,rate:e})},function(t,n,c){if(t){if(voted=!0,208===c)return void modal.info("Вы уже голосовали");i.innerText=Number(i.innerText)+Number(e)}}):modal.error("Нельзя голосовать за свою статью"))}t.addEventListener("click",function(){c(1)}),n.addEventListener("click",function(){c(-1)})}const comment={letters:0};function initComments(){const e=document.querySelector(".add-comment"),t=e.querySelector(".writer"),n=t.querySelector("textarea"),i=t.querySelector(".counter span"),c=t.querySelector(".post-comment"),r=e.querySelector(".add-comment-error"),s=document.querySelectorAll(".comment"),o=document.querySelectorAll(".comment .rate-comment");comment.writer=t,n.addEventListener("input",function(){let e=n.value;comment.letters=e.length,comment.letters>1e3?n.value=e.substring(0,1e3):i.innerText=1e3-comment.letters}),c.addEventListener("click",function(t){const i=n.value;i.length<5||i.length>1e3||xhr.request({method:"POST",path:"/services/articles/comments",headers:{"Content-Type":"application/json"},content:JSON.stringify({text:i.substring(0,1e3),id:articleId})},function(t,n){if(t){const n=JSON.parse(t),i=document.createElement("div");r.style.display="none",i.classList.add("comment"),i.setAttribute("user",n.user.id),i.setAttribute("id","comment-"+n.id),i.innerHTML='<div class="left-side">                            <img class="ava" src="/'+n.user.userImage+'"/>                            <div class="rating">                                <svg  class="rate-comment" content="'+n.id+':1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#A9A9A9" d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"></path></svg>                                <span class="rate">'+n.rating+'</span>                                <svg  class="rate-comment" content="'+n.id+':-1" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="#A9A9A9" d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></svg>                            </div>                        </div>                        <div class="right-side">                            <div class="top-info">                               <div class="left">                                <div class="user-info">                                    <div class="login">'+n.user.login+'</div>                                    <div class="user-rating">                                        <svg aria-hidden="true" data-prefix="fas" data-icon="star" class="svg-inline--fa fa-star fa-w-18" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="#ffcb05" d="M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"></path></svg>                                        <span>'+n.user.rating+'</span>                                    </div>                                </div>                                <div class="date">                                    <svg aria-hidden="true" data-prefix="far" data-icon="calendar-alt" class="svg-inline--fa fa-calendar-alt fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="#adb5bd" d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"></path></svg>                                    <span>'+n.createDate+'</span></div>                                   </div>                              <div class="right"></div>                            </div>                            <div class="comment-text">'+n.text+"</div>                        </div>",e.parentNode.insertBefore(i,e.nextSibling);const c=e.nextElementSibling.querySelectorAll(".rate-comment");for(let e=0;e<c.length;e++)commentRate(c[e])}else n&&(r.style.display="block")})});for(let e=0;e<o.length;e++)commentRate(o[e]);for(let e=0;e<s.length;e++)s[e].getAttribute("user")===userId&&editComment(s[e])}function editComment(e){const t=e.querySelector(".top-info .right"),n=e.getAttribute("id").split("-")[1],i=document.createElement("i"),c=document.createElement("i");i.setAttribute("content",n),c.setAttribute("content",n),i.addEventListener("click",function(e){const t=e.currentTarget.getAttribute("content"),n=document.querySelector("#comment-"+t+" .right-side"),i=n.querySelector(".comment-text");if(n.classList.contains("comment-edit"))return n.querySelector(".comment-change").style.display="none",i.style.display="block",void n.classList.remove("comment-edit");if(n.classList.add("comment-edit"),i.style.display="none",null===n.querySelector(".comment-change")){let e=document.createElement("div");e.classList.add("comment-change"),e.innerHTML='<textarea id="comment-change"></textarea>                                <div class="actions">                                    <div class="counter">Осталось символов: <span>1000</span></div>                                    <div class="save">Сохранить</div>                                </div>',n.appendChild(e)}else n.querySelector(".comment-change").style.display="block";let c=n.querySelector(".comment-change"),r=c.querySelector(".counter span"),s=c.querySelector(".save"),o=c.querySelector("textarea");o.innerText=i.innerText,r.innerText=1e3-i.innerText.substring(0,1e3).length,o.addEventListener("input",function(){o.value.length>=1e3&&(o.value=o.value.substring(0,1e3)),r.innerText=1e3-o.value.length}),s.addEventListener("click",function(){const e=o.value;e.length<10||e.length>1e3||xhr.request({path:"/services/articles/comments",method:"PUT",headers:{"Content-Type":"application/json"},content:JSON.stringify({id:t,text:e})},function(t){t&&(i.innerText=e,c.style.display="none",i.style.display="block")})})}),c.addEventListener("click",function(e){const t=e.currentTarget.getAttribute("content"),n=modal.createDefaultButton("Удалить",modal.warningColor),i=modal.createDefaultButton("Отмена",modal.infoColor);n.addEventListener("click",function(){xhr.request({path:"/services/articles/comments",method:"DELETE",headers:{"Content-Type":"application/json"},content:JSON.stringify({id:t})},function(e){if(e){const e=document.getElementById("comment-"+t);e.parentNode.removeChild(e)}})}),modal.customActions(n,i),modal.warning("Вы действительно хотите удалить комментарий?")}),i.innerHTML='<svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#E5E8EA" d="M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z"></path></svg>',c.innerHTML='<svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="#D6DADE" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>',t.appendChild(i),t.appendChild(c)}function commentRate(e){e.addEventListener("click",function(e){let t=e.currentTarget,n=t.getAttribute("content").split(":"),i=n[0],c=n[1];t.parentElement.parentElement.parentElement.getAttribute("user")!==userId?xhr.request({path:"/services/articles/comments/rating",method:"POST",headers:{"Content-Type":"application/json"},content:JSON.stringify({id:i,rate:c})},function(e,n,i){if(e){if(208===i)return void modal.info("Вы уже голосовали");let e=t.parentElement.querySelector(".rate");e.innerText=Number(e.innerText)+Number(c)}}):modal.error("Нельзя голосовать за свой комментарий")})}initRating(),initComments();