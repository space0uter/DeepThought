"use strict";const editor={instance:void 0,input:void 0,save:void 0},editValues={firstName:{path:"/services/user/update/fname",check:function(){const e=editor.input.value;return e.length<3||e.length>32?(modal.error("Длина имени должна быть от 3 до 32 символов"),!1):!!e.match(/^[A-z|А-я]+$/)||(modal.error("Имя может состоять только из букв"),!1)}},lastName:{path:"/services/user/update/lname",check:function(){const e=editor.input.value;return e.length<3||e.length>32?(modal.error("Длина фамилии должна быть от 3 до 32 символов"),!1):!!e.match(/^[A-z|А-я]+$/)||(modal.error("Фамилия может состоять только из букв"),!1)}},about:{path:"/services/user/update/about",check:function(){const e=editor.input.value;return e.length<10||e.length>1e3?(modal.error("Информация о вас должна быть не менее 10 и не превышать 1000 символов"),!1):!!e.match(/^[A-z|А-я|\s|0-9]+$/)||(modal.error("Неверный формат информации о вас"),!1)}},birthDay:{path:"/services/user/update/bday",check:function(){const e=editor.input.value,t=e.split("-");return e.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/)?Number(t[2])>31||0===Number(t[2])?(modal.error("Неверный формат дня"),!1):!(Number(t[1])>12||0===Number(t[1]))||(modal.error("Неверный формат месяца"),!1):(modal.error("Неверный формат даты"),!1)}},email:{path:"/services/user/update/email",check:function(){const e=editor.input.value;return e.length<6||e.length>50?(modal.error("Размер email должен быть от 6 до 50 символов"),!1):!!e.match(/^[A-z|0-9|_|.]+?@[A-z]+?\.[A-z]+?$/)||(modal.error("Неверный формат email"),!1)}},current:void 0,name:""};function initEditor(){const e=document.createElement("div");e.classList.add("editor"),e.innerHTML='<div class="content"><input type="text"/> </div>                                <div class="actions">                                    <div class="save action">Сохранить</div>                                    <div class="unsave action">Отмена</div>                                </div>',e.querySelector(".unsave").addEventListener("click",function(){e.style.display="none",e.previousElementSibling.style.display="flex"}),e.querySelector(".save").addEventListener("click",function(){editValues.current.check()&&xhr.request({path:editValues.current.path,method:"POST",headers:{"Content-Type":"application/json"},content:JSON.stringify({value:editor.input.value})},function(e,t){if(e){"email"!==editValues.name?editor.instance.parentNode.querySelector(".value span").innerText=editor.input.value:modal.info("Подтвердите почту для успешной смены email");let e=editor.instance.parentNode.querySelector(".value"),t=e.querySelector(".empty");e.style.display="flex",null!==t&&(t.style.display="none"),editor.instance.style.display="none"}else t&&(modal.error("Не удалось обновить данные"),editor.instance.parentNode.querySelector(".value").style.display="flex",editor.instance.style.display="none")})}),editor.instance=e,editor.input=e.querySelector("input"),editor.save=e.querySelector(".save")}function initEditValues(){const e=document.querySelectorAll(".edit-marker");for(let t=0;t<e.length;t++){e[t].querySelector(".edit").addEventListener("click",function(e){const t=e.currentTarget,n=t.getAttribute("content");null!==editor.instance.parentNode&&(editor.instance.parentNode.querySelector(".value").style.display="flex"),editValues.name=n,editValues.current=editValues[n],t.parentNode.style.display="none",t.parentNode.parentNode.appendChild(editor.instance),editor.instance.style.display="block",editor.input.value=t.parentNode.querySelector("span").innerText})}}const userImage={imageDiv:document.querySelector(".user-image")};function initUserImage(){userImage.img=userImage.imageDiv.querySelector(".ava"),userImage.cover=userImage.imageDiv.querySelector(".image-cover"),userImage.fileInput=document.getElementById("userImageInput"),userImage.fileInput.addEventListener("change",function(){let e=new FormData;e.append("file",userImage.fileInput.files[0]),xhr.request({path:"/services/user/update/image",method:"POST",headers:{"Upload-Type":"user.profile"},content:e},function(e,t){e?userImage.img.src="/"+JSON.parse(e).large:t&&modal.error("Не удалось обновить фотографию")})}),userImage.imageDiv.addEventListener("mouseenter",function(){userImage.cover.style.display="flex"}),userImage.imageDiv.addEventListener("mouseleave",function(){userImage.cover.style.display="none"})}if(-1!==window.location.href.toLowerCase().lastIndexOf("user")){const e={elem:document.querySelector(".tag-element")};function closeEditor(){e.editor.style.display="none",e.value.style.display="flex",addTagsToEditor()}function addTagsToEditor(){let t=e.tagContainer.querySelectorAll(".tag"),n=tags.tagsInputContainer.querySelectorAll(".selected-tag");for(let e=0;e<n.length;e++)n[e].parentNode.removeChild(n[e]);for(let e=0;e<t.length;e++){const n=t[e],r=document.createElement("div");r.classList.add("chip","chip-suggest","selected-tag"),r.innerText=n.innerText,r.addEventListener("click",deleteTagOnClick),r.setAttribute("content",n.getAttribute("content")),r.style.background=n.getAttribute("color"),r.style.minWidth=8*r.innerText.length+"px",tags.tagsCount[n.getAttribute("content")]=1,tags.tagsInputContainer.insertBefore(r,tags.tagInput)}}e.value=e.elem.querySelector(".value"),e.tagContainer=e.value.querySelector(".tag-container"),e.editor=e.elem.querySelector(".tags"),addTagsToEditor(),tags.tagInput.addEventListener("keydown",onTagInputStart),tags.tagInput.addEventListener("keyup",onTagInputEnd),e.value.querySelector(".edit").addEventListener("click",function(t){e.value.style.display="none",e.value.nextElementSibling.style.display="block"}),e.elem.querySelector("#tags-input").addEventListener("focus",function(){tags.tagView.style.display="flex"}),e.elem.querySelector("#tags-input").addEventListener("blur",function(){tags.closeTagViewTimer=setTimeout(function(){tags.tagView.style.display="none"},200)}),e.elem.querySelector(".save").addEventListener("click",function(t){const n=Object.keys(tags.tagsCount),r=tags.tagsInputContainer.querySelectorAll(".selected-tag");xhr.request({path:"/services/user/update/interests",method:"POST",headers:{"Content-Type":"application/json"},content:JSON.stringify({tags:n})},function(t,n){if(t){let t=e.tagContainer.parentNode.querySelector(".empty");null!==t&&(t.style.display="none"),e.tagContainer.innerHTML="";for(let t=0;t<r.length;t++){let n=r[t],a=document.createElement("a"),o=n.getAttribute("content");a.classList.add("tag"),a.setAttribute("color",n.style.background),a.setAttribute("content",o),a.href="/tags/"+o,a.innerText=n.innerText,e.tagContainer.appendChild(a)}}else n&&modal.error("Не удалось обновить интересы");closeEditor()})}),e.elem.querySelector(".unsave").addEventListener("click",function(e){closeEditor()})}else if(-1!==window.location.href.toLowerCase().lastIndexOf("account")){const e={elem:document.querySelector(".password-element")},t=document.createElement("editor");t.classList.add("editor"),t.style.display="none",t.innerHTML='<div class="content">   <input id="oldPassword" placeholder="Старый пароль" type="password"/>    <input id="newPassword" placeholder="Новый пароль" type="password"/>    <input id="confirmPassword" placeholder="Подтвердите пароль" type="password"/> </div><div class="actions">    <div class="save action">Сохранить</div>    <div class="unsave action">Отмена</div></div>',e.editor=t,e.elem.appendChild(e.editor),e.oldPassword=t.querySelector("#oldPassword"),e.newPassword=t.querySelector("#newPassword"),e.confirmPassword=t.querySelector("#confirmPassword"),e.value=e.elem.querySelector(".value"),t.querySelector(".save").addEventListener("click",function(){e.oldPassword.value.length<5||e.oldPassword.value.length>32||!e.oldPassword.value.match(/^[A-z|0-9|А-я]+$/)?modal.error("Неправильный пароль"):e.newPassword.value.length<5||e.newPassword.value.length>32||!e.newPassword.value.match(/^[A-z|0-9|А-я]+$/)?modal.error("Неправильный новый пароль"):e.newPassword.value===e.confirmPassword.value?xhr.request({path:"/services/user/update/password",method:"POST",headers:{"Content-Type":"application/json"},content:JSON.stringify({oldPassword:e.oldPassword.value,newPassword:e.newPassword.value})},function(t,n){t?modal.info("Пароль был успешно изменен"):n&&modal.error("Не удалось изменить пароль"),e.editor.style.display="none",e.value.style.display="flex"}):modal.error("Пароли не совпадают")}),t.querySelector(".unsave").addEventListener("click",function(){e.value.style.display="flex",e.editor.style.display="none"}),e.elem.querySelector(".edit").addEventListener("click",function(){e.value.style.display="none",e.editor.style.display="block"})}initEditor(),initEditValues(),initUserImage();