"use strict";const editor={area:document.getElementById("describeInput"),counter:document.querySelector(".content .describe .counter span"),create:document.querySelector(".create"),creating:!1,edit:!1};function initEditor(){editor.area.addEventListener("input",function(){const t=editor.area.value;t.length>1e3&&(editor.value=t.substring(0,1e3)),editor.counter.innerText=1e3-t.length})}function create(){editor.create.addEventListener("click",function(){let t=Object.keys(tags.tagsCount),e=editor.area.value;editor.creating||(t.length<3||t.length>5?modal.error("Кол-во тегов должно быть от 3 до 5"):e.length<100||e.length>1e3?modal.error("Длина описания должна быть больше 100 и не превышать 1000 символов"):(editor.creating=!0,editor.edit?(xhr.request({path:"/services/facts",method:"PUT",headers:{"Content-Type":"application/json"},content:JSON.stringify({factId:editor.factId,tags:t,text:e})},function(t,e){if(t){let t=window.location.href;window.location.href=t.substring(0,t.lastIndexOf("facts")+"facts".length)}else e&&modal.error("Не удалось обновить факт");editor.creating=!1}),modal.load("Идёт обновление факта...")):(xhr.request({path:"/services/facts",method:"POST",headers:{"Content-Type":"application/json"},content:JSON.stringify({tags:t,text:e})},function(t,e){if(t){let e=window.location.href;JSON.parse(t);window.location.href=e.substring(0,e.lastIndexOf("add"))}else e&&modal.error("Не удалось создать факт");editor.creating=!1}),modal.load("Идёт создание факта..."))))})}function initIfEdit(){if(null==document.getElementById("_edit"))return;editor.edit=!0;const t=document.getElementById("text_edit"),e=document.getElementById("tags_edit"),n=e.children;for(let t=0;t<n.length;t++){let e=n[t],r=document.createElement("div"),i=e.getAttribute("name"),o=e.getAttribute("color"),a=e.getAttribute("content");r.classList.add("selected-tag","chip"),r.style.background=o,r.innerText=i,r.style.color="#ffffff",r.setAttribute("content",a),r.addEventListener("click",deleteTagOnClick),tags.tagsCount[a]=1,tags.tagsInputContainer.insertBefore(r,tags.tagInput)}upPlaceholder(),editor.area.value=t.getAttribute("content").trim(),editor.factId=document.getElementById("fact_id").getAttribute("content"),t.parentNode.removeChild(t),e.parentNode.removeChild(e)}initTags(),initIfEdit(),initEditor(),create();